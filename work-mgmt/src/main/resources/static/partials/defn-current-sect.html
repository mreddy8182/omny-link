<section id="currentSect" style="display:none">
  <h2>
    <span>{{current.name}}</span>
    <div class="pull-right">
      {{#current.deploymentId}}
        {{#current.suspended}}
          <a class="glyphicon glyphicon-pause" aria-hidden="true" onclick="ractive.activate('{{current.id}}')" title="Activate"></a>
        {{else}}
          <a class="glyphicon glyphicon-play" aria-hidden="true" onclick="ractive.startInstance('{{current.id}}', '{{current.name}}', '{{username}}')" title="Start instance"></a>
          <a class="glyphicon glyphicon-pause" aria-hidden="true" onclick="ractive.suspend('{{current.id}}')" title="Suspend"></a>
        {{/}}
      {{/}}
      <a class="glyphicon glyphicon-cloud-download" href="{{context}}/{{tenant.id}}/process-definitions/{{current.id}}.bpmn" target="bpmn" title="Download the BPMN representation of the process"></a>
      {{#current.deploymentId}}
        <a class="clickable glyphicon glyphicon-remove" aria-hidden="true" onclick="ractive.delete({{current.deploymentId}})" title="Delete this definition"></a>
      {{/}}
      {{^current.deploymentId}}
        <a class="clickable glyphicon glyphicon-remove" aria-hidden="true" onclick="ractive.delete('{{current.id}}')" title="Delete this definition"></a>
      {{/}}
    </div>
  </h2>
  <p>{{current.description}}</p>
  <table class="table">
    <thead>
      <tr>
        <th>Id</th>
        {{#current.category}}<th>Category</th>{{/}}
        {{#current.deployment.deploymentTime}}<th>Deployed At</th>{{/}}
        <th>Hash</th>
        <th>Deployment Id</th>
        {{#current.deployment.name}}<th>Deployment</th>{{/}}
        <th>Active?</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{current.id}}</td>
        {{#current.category}}<td>{{current.category}}</td>{{/}}
        {{#current.deployment.deploymentTime}}<td>{{formatDateTime(current.deployment.deploymentTime)}}</td>{{/}}
        <td>{{current.md5Hash}};</td>
        {{#current.deploymentId}}<td>{{current.deploymentId}}</td>{{else}}<td>Incomplete model cannot be run</td>{{/}}
        {{#current.deployment.name}}<td>{{current.deployment.name}}</td>{{/}}
        <td>{{!current.suspended}}</td>
      </tr>
    </tbody>
  </table>
  {{#current.messageNames}}
    <ul>
      <li><a href="{{context}}/{{tenant.id}}/messages/{{.}}.html">API for {{.}}</a></li>
    </ul>
  {{/}}
  {{#if current.id}}
    {{# current.diagrams:i}}
      <h3>
        <span>Diagram: {{current.diagrams[i].name}}</span>
        <a class="glyphicon glyphicon-picture pull-right" href="{{context}}/{{tenant.id}}/process-definitions/{{current.id}}/{{current.diagrams[i].id}}.png" style="margin-top:-15px" target="_blank" title="Image of process diagram '{{current.diagrams[i].name}}'"></a>
      </h3>
      <div class="bpmnDiagram">{{{current.diagrams[i].image}}}</div>
      {{#if selectedBpmnObject}}
        <h3>
          <span>Properties</span>
        </h3>
        <table id="propertiesTable" style="width:100%">
          <thead>
            <tr>
              {{#if hasRole('admin') }}<th class="a-secondary-label control-label">Id</th>{{/if}}
              <th class="a-secondary-label control-label">Name</th>
              <th class="a-secondary-label control-label">Type</th>
              <th class="a-secondary-label control-label">{{selectedBpmnObject.element.localName.toLabel()}} Definition</th>
              <!--th>Actions</th-->
            </tr>
          </thead>
          <tbody>
            <tr>
              {{#if hasRole('admin') }}<td class="col-md-1">{{selectedBpmnObject.id}}</td>{{/if}}
              <td class="col-md-1">{{#selectedBpmnObject.name}}{{selectedBpmnObject.name}}{{else}}n/a{{/}}</td>
              <td class="col-md-1">{{selectedBpmnObject.type.toLabel()}}</td>
              <td class="col-md-6">
                {{#if selectedBpmnObject.element.localName == 'boundaryEvent' && selectedBpmnObject.element.querySelectorAll('timerEventDefinition').length>0}}
                  {{#selectedBpmnObject.timerCycle}}<label>Timer Cycle: </label>{{selectedBpmnObject.timerCycle}}{{/}}
                  {{#selectedBpmnObject.timerDate}}<label>Timer Date: </label>{{selectedBpmnObject.timerDate}}{{/}}
                  {{#selectedBpmnObject.timerDuration}}<label>Timer Duration: </label>{{selectedBpmnObject.timerDuration}}{{/}}
                {{elseif selectedBpmnObject.element.localName == 'callActivity'}}
                  <label>Sub-Process: </label> {{selectedBpmnObject.element.getAttribute('calledElement')}}
                {{elseif selectedBpmnObject.element.localName == 'dataStoreReference'}}
                  <label>Data Store: </label> {{current.bpmn.querySelectorAll('dataStore[id="'+selectedBpmnObject.element.getAttribute('dataStoreRef')+'"]')[0].getAttribute('name')}}<br/>
                  <label>Capacity: </label>
                    {{#if current.bpmn.querySelectorAll('dataStore[id="'+selectedBpmnObject.element.getAttribute('dataStoreRef')+'"]')[0].getAttribute('isUnlimited') && current.bpmn.querySelectorAll('dataStore[id="'+selectedBpmnObject.element.getAttribute('dataStoreRef')+'"]')[0].getAttribute('isUnlimited')=='true'}}
                      unlimited
                    {{else}}
                      {{current.bpmn.querySelectorAll('dataStore[id="'+selectedBpmnObject.element.getAttribute('dataStoreRef')+'"]')[0].getAttribute('capacity')}}
                    {{/if}}
                {{elseif selectedBpmnObject.element.localName.indexOf('Event')!=-1 && selectedBpmnObject.element.querySelectorAll('signalEventDefinition').length>0}}
                  <label>Signal: </label>{{current.bpmn.querySelectorAll('signal[id="'+selectedBpmnObject.element.querySelectorAll('signalEventDefinition')[0].getAttribute('signalRef')+'"]')[0].getAttribute('name')}}<br/>
                {{elseif selectedBpmnObject.element.localName == 'scriptTask'}}
                  <pre>{{selectedBpmnObject.script}}</pre>
                {{elseif selectedBpmnObject.element.localName == 'sequenceFlow' && selectedBpmnObject.element.querySelectorAll('conditionExpression').length>0}}
                  <pre>{{selectedBpmnObject.condition}}</pre>
                {{elseif selectedBpmnObject.element.localName == 'serviceTask'}}
                  {{selectedBpmnObject.serviceType}}<br/>{{{selectedBpmnObject.extensionDetails}}}
                {{elseif (selectedBpmnObject.element.localName == 'userTask' || selectedBpmnObject.element.localName == 'manualTask')}}
                  {{#selectedBpmnObject.element.getAttribute('activiti:assignee')!=undefined}}<label>Assign to: </label>{{selectedBpmnObject.element.getAttribute('activiti:assignee')}}<br/>{{/}}
                  {{#selectedBpmnObject.element.getAttribute('activiti:candidateUsers')!=undefined}}<label>Offer to user: </label>{{selectedBpmnObject.element.getAttribute('activiti:candidateUsers')}}<br/>{{/}}
                  {{#selectedBpmnObject.element.getAttribute('activiti:candidateGroups')!=undefined}}<label>Offer to group: </label>{{selectedBpmnObject.element.getAttribute('activiti:candidateGroups')}}<br/>{{/}}
                  {{#selectedBpmnObject.element.querySelectorAll('resourceRef').length>0}}<label>Offer to: </label>{{current.bpmn.querySelectorAll('resource[id="'+selectedBpmnObject.element.querySelectorAll('resourceRef')[0].textContent+'"]')[0].getAttribute('name')}}<br/>{{/}}
                  {{#selectedBpmnObject.element.querySelectorAll('formalExpression').length>0}}<label>Offer to: </label>{{selectedBpmnObject.element.querySelectorAll('formalExpression')[0].textContent}}<br/>{{/}}
                {{else}}
                
                {{/if}}
              </td>
              <!--td>&nbsp;</td-->
            </tr>
          </tbody>
        </table>
      {{/if}} 
    {{/}}
  {{/if current.id}}
  {{#current.deploymentId}}
    {{>instanceListSect}}
  {{/}}
  {{^current.deploymentId}}
    <section style="margin-bottom: 2px;">
      <span class="glyphicon glyphicon-warning-sign pull-right" on-click="showIssues()" style="position:relative;top:-12px;"></span>
      <h3>Items to be completed</h3>
      <p>To be eligible for execution these parts of the model need to be completed.</p>
      <table>
        <thead></thead>
        <tbody>
          {{#current.issues:i}}
            <tr>
              <td><a href="#{{modelRef}}" data-ref="{{modelRef}}">{{i+1}}</a></td>
              <!-- <td class="col-md-1">{{level}}</td> -->
              <td>{{description}}</td>
            </tr>
          {{/}}
        </tbody>
      </table>
    </section><!-- /List of items to complete -->
  {{/}}
</section>
